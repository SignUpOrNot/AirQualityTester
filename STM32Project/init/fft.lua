SIN_TAB = { 0,0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 59, 65, 70, 75, 80, 85, 89, 94, 98, 102, 

105, 108, 112, 114, 117, 119, 121, 123, 124, 125, 126, 126, 126, 126, 126, 125, 124, 123, 121, 119, 117, 114, 112, 

108, 105, 102, 98, 94, 89, 85, 80, 75, 70, 65, 59, 54, 48, 42, 36, 30, 24, 18, 12, 6, 0, -6, -12, -18, -24, -30, 

-36, -42, -48, -54, -59, -65, -70, -75, -80, -85, -89, -94, -98, -102, -105, -108, -112, -114, -117, -119, -121, 

-123, -124, -125, -126, -126, -126, -126, -126, -125, -124, -123, -121, -119, -117, -114, -112, -108, -105, -102, 

-98, -94, -89, -85, -80, -75, -70, -65, -59, -54, -48, -42, -36, -30, -24, -18, -12, -6 };

COS_TAB = { 0,127, 126, 126, 125, 124, 123, 121, 119, 117, 114, 112, 108, 105, 102, 98, 94, 

89, 85, 80, 75, 70, 65, 59, 54, 48, 42, 36, 30, 24, 18, 12, 6, 0, -6, -12, -18, -24, -30, -36, -42, -48, -54, -59, 

-65, -70, -75, -80, -85, -89, -94, -98, -102, -105, -108, -112, -114, -117, -119, -121, -123, -124, -125, -126, -

126, -126, -126, -126, -125, -124, -123, -121, -119, -117, -114, -112, -108, -105, -102, -98, -94, -89, -85, -80, 

-75, -70, -65, -59, -54, -48, -42, -36, -30, -24, -18, -12, -6, 0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 59, 65, 70, 

75, 80, 85, 89, 94, 98, 102, 105, 108, 112, 114, 117, 119, 121, 123, 124, 125, 126, 126 };

LIST_TAB = { 
0, 64, 32, 96, 16, 80, 48, 112,
8, 72, 40, 104, 24, 88, 56, 120,
4, 68, 36, 100, 20, 84, 52, 116,
12, 76, 44, 108, 28, 92, 60, 124,
2, 66, 34, 98, 18, 82, 50, 114,
10, 74, 42, 106, 26, 90, 58, 122,
6, 70, 38, 102, 22, 86, 54, 118,
14, 78, 46, 110, 30, 94, 62, 126,
1, 65, 33, 97, 17, 81, 49, 113,
9, 73, 41, 105, 25, 89, 57, 121,
5, 69, 37, 101, 21, 85, 53, 117,
13, 77, 45, 109, 29, 93, 61, 125,
3, 67, 35, 99, 19, 83, 51, 115,
11, 75, 43, 107, 27, 91, 59, 123,
7, 71, 39, 103, 23, 87, 55, 119,
15, 79, 47, 111, 31, 95, 63, 127
};
adcdata={29,27,36,58,106,122,159,169,172,174,180,181,178,177,175,176,169,161,125,110,93,84,72,60,40,27,24,5,3,1,0,0,0,0,1,0,0,0,0,0,0,3,4,2,10,3,6,14,21,14,15,16,17,18,27,22,27,22,29,29,29,29,36,29,34,36,103,108,120,135,147,152,162,164,169,177,177,178,186,177,187,177,182,172,164,161,151,141,127,116,101,94,79,63,49,39,22,12,3,1,0,0,0,0,0,0,0,1,1,1,0,2,1,0,2,6,7,7,6,7,9,10,13,10,14,16,17,17}

function fill()
    for i=1,128 do
        --print(i)
        Fft_Real[LIST_TAB[i]+1]=adcdata[i]
        Fft_Image[i-1]=0
    end
end

function FFT()
    for i=1,7 do
        b=1;
        b=bit.lshift(b,i-1)
        for j=0,b-1 do
            p=1;
            p=bit.lshift(p,7-i)
            p = p*j
            for k=j+1,128 do
                --print(k,k+b,p+1)
                if (k+b)>128 then
                    b=b-1
                end
                Temp_Real = Fft_Real[k]
                Temp_Imag = Fft_Image[k]
                temp = Fft_Real[k+b]
                --jjw=(Fft_Real[k+b]*COS_TAB[p])
                Fft_Real[k] = Fft_Real[k] + bit.rshift(Fft_Real[k+b]*COS_TAB[p+1],7) 
                Fft_Image[k] = Fft_Image[k] - bit.rshift(Fft_Real[k+b]*SIN_TAB[p+1],7) 
                Fft_Real[k+b] = Temp_Real - bit.rshift(Fft_Real[k+b]*COS_TAB[p+1],7) 
                Fft_Image[k+b] = Temp_Imag + bit.rshift(temp*SIN_TAB[p+1],7) 
                Fft_Real[k]=bit.rshift(Fft_Real[k],1)             
                Fft_Real[k+b]=bit.rshift(Fft_Real[k+b],1)
                tmr.wdclr()
            end
        end
    end
--//   Fft_Real[0]=Fft_Image[0]=0;          //去掉直流分量
--//   Fft_Real[63]=Fft_Image[63]=0;
--//  x=((((Fft_Real[1]* Fft_Real[1]))+((Fft_Image[1]*Fft_Image[1])))>>5);
    for j=0,15 do                                            
        TEMP1=bit.rshift((((Fft_Real[j+1]* Fft_Real[j+1]))+((Fft_Image[j+1]*Fft_Image[j+1]))),1)
        if TEMP1>1 then 
            TEMP1=TEMP1-1
        else 
            TEMP1=0;
        end
        if TEMP1>31 then
            TEMP1=31; 
        end
        if TEMP1>LED_TAB[j+1] then
            LED_TAB[j+1]=TEMP1; 
        end
        if TEMP1>LED_TAB1[j+1] then
           LED_TAB1[j+1]=TEMP1;
           LED_TAB2[j+1]=14;                   --  //提顿速度=12
        end
    end       
end


Fft_Real={} 
Fft_Image={}
LED_TAB2={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
LED_TAB={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
LED_TAB1={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
fill()
FFT()
for i=0,15 do
    print(LED_TAB[i])
end